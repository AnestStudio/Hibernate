# Association Mappings

Một __liên kết (association)__ là một mối quan hệ giữa các thực thể. Chúng ta phân loại các liên kết dựa trên tính chất - đặc điểm của chúng. Nếu `E` và `F` đều là các lớp thực thể thì:
- __one-to-one__: 1 thể hiện duy nhất của `E` liên kết với 1 thể hiện duy nhất của `F`.
- __many-to-one__: 0 hoặc nhiều thể hiện của `E` liên kết với 1 thể hiện duy nhất của `F`.
- __many-to-many__: 0 hoặc nhiều thể hiện của `E` liên kết với 1 hoặc nhiều thể hiện của `F`.

Một liên kết giữa các lớp thực thể có thể là:
- __một chiều (unidirectional)__: có thể điều hướng từ `E` đến `F` nhưng không thể từ `F` tới `E`.
- __hai chiều (bidirectional)__: có thể điều hướng theo một trong hai hướng.

Có 3 chú thích cho các liên kết ánh xạ là: 
- @ManyToOne
- @OneToMany
- @ManyToMany
  
Chúng dùng chung một số thành phần chú thích như sau:

| Member | Interpretation |	Default value |
| ------ | -------------- | ------------- |
| _cascade_      | - | { } |
| _fetch_        | - | - __LAZY__ cho `@OneToMany` và `@ManyToMany` <br /> - __EAGER__ cho `@ManyToOne` |
| _targetEntity_ | Lớp thực thể liên quan | Xác định từ khai báo kiểu thuộc tính |
| _optional_     | Đối với liên kết `@ManyToOne` hoặc `@OneToOne`, liên kết có thể `null` hay không | `true` |
| _mappedBy_     | Đối với một liên kết hai chiều, một thuộc tính của thực thể liên kết sẽ ánh xạ liên kết đó | Theo mặc định, liên kết được coi là một chiều |

Chúng ta sẽ giải thích chi tiết tác dụng của các thành phần này khi chúng ta xem xét các loại ánh xạ liên kết khác nhau.

<br />

## 1. `many-to-one`

<br />

## 2. `one-to-one` (first way)

Giả sử chúng ta sẽ có 2 đối tượng là `User` và `UserDetail`, một đối tượng `User` sẽ chỉ có tương ứng một thông tin `UserDetail` trong cơ sở dữ liệu.

<p align="center">
  <img src="https://github.com/AnestStudio/Hibernate/blob/main/images/user__user_detail.png">
</p>

Mối liên kết one-to-one phải được chú thích bằng annotation `@OneToOne` như sau:
```java
@Getter
@Setter
@Entity
@Table(name = "user_detail")
public class UserDetail {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "user_detail_id")
    private Long userDetailId;

    @Column(name = "first_name")
    private String firstName;

    @Column(name = "last_name")
    private String lastName;

    @Column
    private String gender;

    @Column
    private String bod;

    @Column
    private String mobile;

    @Column
    private String email;

    @OneToOne
    @JoinColumn(name = "user_id", referencedColumnName = "user_id")
    private User user;
}
```

Ở đây, bảng `user_detail` sẽ có một cột khóa ngoại chứa mã định danh của `user` là `user_id`.

Mặc định Hibernate sẽ generate tên của khóa ngoại dựa trên tên của thuộc tính và primary key của bảng được tham chiếu, ở đây là bảng `User`. Chúng ta sử dụng `@JoinColumn` để thay đổi giá trị mặc định này theo ý muốn.

<br />

## 3. `one-to-one` (first way)

<br />

## 4. `many-to-many` (second way)

<br />
